<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IndexedDB Example</title>
</head>

<body>
  <h1>IndexedDB Example</h1>
  <form id="taskForm">
    <input type="text" id="taskTitle" placeholder="Task Title" required>
    <input type="text" id="taskDescription" placeholder="Task Description" required>
    <button type="submit">Add Task</button>
  </form>
  <button id="clearAllTasks">Clear All Tasks</button>
  <ul id="taskList"></ul>

  <script>
    // IndexedDB setup code here

    const dbName = "myDatabase";
    let db;

    const request = indexedDB.open(dbName, 1);

    request.onupgradeneeded = (event) => {
      db = event.target.result;
      if (!db.objectStoreNames.contains('tasks')) {
        const objectStore = db.createObjectStore('tasks', { keyPath: 'id', autoIncrement: true });
        objectStore.createIndex('title', 'title', { unique: false });
      }
    };

    request.onsuccess = (event) => {
      db = event.target.result;
      console.log("Database opened successfully");
      displayTasks();
    };

    request.onerror = (event) => {
      console.error("Database error:", event.target.errorCode);
    };
    // db opend --------------------------------------------------------------->

    // Function to add task
    function addTask(title, description) {
      const transaction = db.transaction(['tasks'], 'readwrite');
      const objectStore = transaction.objectStore('tasks');
      const task = { title, description, created: new Date() };
      const request = objectStore.add(task);

      request.onsuccess = () => {
        console.log("Task added successfully");
        displayTasks();
      };

      request.onerror = (event) => {
        console.error("Error adding task:", event.target.errorCode);
      };
    }

    // Function to display tasks
    function displayTasks() {
      const transaction = db.transaction(['tasks']);
      const objectStore = transaction.objectStore('tasks');
      const request = objectStore.getAll();

      request.onsuccess = (event) => {
        const tasks = event.target.result;
        const taskList = document.getElementById('taskList');
        taskList.innerHTML = '';
        tasks.forEach(task => {
          const listItem = document.createElement('li');
          listItem.textContent = `${task.title}: ${task.description} , ${task.id}`;
          // Add a delete button for each task
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Delete';
          deleteButton.addEventListener('click', () => deleteTask(task.id));
          listItem.appendChild(deleteButton);
          taskList.appendChild(listItem);
        });
      };

      request.onerror = (event) => {
        console.error("Error fetching tasks:", event.target.errorCode);
      };
    }

    // Function to delete task
    function deleteTask(id) {
      const transaction = db.transaction(['tasks'], 'readwrite');
      const objectStore = transaction.objectStore('tasks');
      const request = objectStore.delete(id);

      request.onsuccess = () => {
        console.log("Task deleted successfully");
        displayTasks();
      };

      request.onerror = (event) => {
        console.error("Error deleting task:", event.target.errorCode);
      };
    }

    // Function to clear all tasks
    function clearAllTasks() {
      const transaction = db.transaction(['tasks'], 'readwrite');
      const objectStore = transaction.objectStore('tasks');
      const request = objectStore.clear();

      request.onsuccess = () => {
        console.log("All tasks cleared successfully");
        displayTasks();
      };

      request.onerror = (event) => {
        console.error("Error clearing tasks:", event.target.errorCode);
      };
    }

    // Event listener for form submission
    document.getElementById('taskForm').addEventListener('submit', (event) => {
      event.preventDefault();
      const title = document.getElementById('taskTitle').value;
      const description = document.getElementById('taskDescription').value;
      addTask(title, description);
    });

    // Event listener for clearing all tasks
    document.getElementById('clearAllTasks').addEventListener('click', clearAllTasks);
  </script>
</body>

</html>